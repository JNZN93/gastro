<div class="article-container">

  <!-- Back Button Header -->
  <div class="back-header">
    <button class="back-button" (click)="goBack()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Zur√ºck
    </button>
  </div>

  <div class="content">
    @if (isAnalyzingImages) {
      <app-upload-loading></app-upload-loading>
    }
    <input #imageInput type="file" multiple accept="image/*" style="display:none" (change)="onImagesSelected($event)">
    <!-- Desktop Ansicht (unver√§ndert) -->
    <div class="main-content desktop-view">
      <!-- Linke Spalte: Auftrag -->
      <div class="order-column">
        @if (globalService.selectedCustomerForOrders) {
        <div class="order-section">
          <div class="order-header">
            <h3>Auftrag f√ºr {{ globalService.selectedCustomerForOrders.last_name_company || globalService.selectedCustomerForOrders.customer_number }}</h3>
            <button (click)="openCustomerModal()" class="change-customer-btn">
              <span class="material-icons">swap_horiz</span>
              Kunde wechseln
            </button>
          </div>
          
          <!-- Kunden-Info-Box -->
          <div class="customer-info-box">
            <div class="customer-details">
              <div class="customer-basic-info">
                <div class="company-name-container" 
                     [class.editing]="isEditingCompanyName"
                     title="Klicken zum Bearbeiten des Firmennamens">
                  @if (isEditingCompanyName) {
                    <input type="text" 
                           [(ngModel)]="editingCompanyName"
                           (keydown)="onCompanyNameKeyDown($event)"
                           (blur)="saveCompanyName()"
                           class="company-name-edit-input"
                           autofocus>
                  } @else {
                    <h4 (click)="startEditCompanyName()">
                      {{ differentCompanyName || globalService.selectedCustomerForOrders.last_name_company || globalService.selectedCustomerForOrders.customer_number }}
                      @if (differentCompanyName) {
                        <span class="edit-indicator">(ge√§ndert)</span>
                      }
                    </h4>
                  }
                </div>
                @if (globalService.selectedCustomerForOrders.name_addition) {
                  <p class="customer-addition">{{ globalService.selectedCustomerForOrders.name_addition }}</p>
                }
                @if (globalService.selectedCustomerForOrders.street || globalService.selectedCustomerForOrders.postal_code || globalService.selectedCustomerForOrders.city) {
                  <p class="customer-location">
                    @if (globalService.selectedCustomerForOrders.street) {
                      {{ globalService.selectedCustomerForOrders.street }}
                    }
                    @if (globalService.selectedCustomerForOrders.postal_code || globalService.selectedCustomerForOrders.city) {
                      <br>
                      @if (globalService.selectedCustomerForOrders.postal_code) {
                        {{ globalService.selectedCustomerForOrders.postal_code }}
                      }
                      @if (globalService.selectedCustomerForOrders.city) {
                        {{ globalService.selectedCustomerForOrders.city }}
                      }
                    }
                  </p>
                }
              </div>
              <div class="customer-pricing-info">
                @if (customerArticlePrices.length > 0) {
                  <div class="pricing-status success" (click)="openArticlePricesModal()" style="cursor: pointer;">
                    <span class="material-icons">check_circle</span>
                    <span>{{ customerArticlePrices.length }} kundenspezifische Preise verf√ºgbar</span>
                    <span class="material-icons click-hint">open_in_new</span>
                  </div>
                } @else {
                  <div class="pricing-status standard" (click)="openArticlePricesModal()" style="cursor: pointer;">
                    <span class="material-icons">info</span>
                    <span>Standard-Preise werden verwendet</span>
                    <span class="material-icons click-hint">open_in_new</span>
                  </div>
                }
              </div>
            </div>
            <button (click)="confirmClearSelectedCustomer()" class="clear-customer-btn" title="Kunde entfernen">
              <span class="material-icons">close</span>
            </button>
          </div>
          
          @if (orderItems.length > 0) {
          <div class="order-table-container" #orderTableContainer>
            <!-- Desktop Tabelle -->
            <table class="order-table">
              <thead>
                <tr>
                  <th>Pos.</th>
                  <th style="width: 30px;"></th>
                  <th>Artikel</th>
                  <th>Art.-Nr.</th>
                  <th>Menge</th>
                  <th>EK-Preis (‚Ç¨)</th>
                  <th>Kundenpreis (‚Ç¨)</th>
                  <th>Gesamtpreis (‚Ç¨)</th>
                  <th colspan="2" style="text-align: center;">Aktionen</th>
                </tr>
              </thead>
              <tbody>
                @for (item of orderItems; track $index; let i = $index) {
                <tr class="order-row" 
                    [class.editing]="editingItemIndex === i"
                    [class.offer-item]="item.use_offer_price && item.offer_price !== undefined"
                    [draggable]="editingItemIndex !== i && editingArticleNameIndex !== i"
                    (dragstart)="onDragStart($event, i)"
                    (dragover)="onDragOver($event)"
                    (drop)="onDrop($event, i)"
                    (dragenter)="onDragEnter($event)"
                    (dragleave)="onDragLeave($event)"
                    [class.drag-over]="dragOverIndex === i"
                    [class.dragging]="draggedIndex === i">
                  <td class="position">
                    <div class="position-content">
                      <span class="position-number">{{ i + 1 }}</span>
                      @if (editingItemIndex !== i && editingArticleNameIndex !== i) {
                        <span class="drag-handle material-icons">drag_indicator</span>
                      }
                    </div>
                  </td>
                  <td class="info-column">
                    <button class="info-btn" 
                            (click)="showArticleNotes(i)"
                            title="Artikel-Notizen anzeigen">
                      <span class="material-icons">info</span>
                    </button>
                  </td>
                  <td class="article-name">
                    <div class="article-name-container" 
                         [class.editing-name]="editingArticleNameIndex === i"
                         title="Klicken zum Bearbeiten des Artikelnamens">
                      @if (item.use_offer_price && item.offer_price !== undefined) {
                        <span class="offer-badge" title="Angebotspreis aktiv">üè∑Ô∏è</span>
                      }
                      @if (editingArticleNameIndex === i) {
                        <input type="text" 
                               [(ngModel)]="editingArticleName"
                               (keydown)="onArticleNameKeyDown($event, i)"
                               (blur)="saveArticleName(i)"
                               (focus)="onArticleNameFocus(i)"
                               class="article-name-edit-input"
                               #articleNameInput>
                      } @else {
                        <span class="article-text" (click)="startEditArticleName(i)" [title]="item.article_text">{{ item.article_text }}</span>
                      }
                    </div>
                  </td>
                  <td class="article-number">
                    <div class="article-number-container" 
                         [class.editing]="editingItemIndex === i"
                         (click)="startEditItem(i)"
                         title="Klicken zum Bearbeiten">
                      <span class="article-number-text">{{ item.article_number }}</span>
                      @if (editingItemIndex === i) {
                        <span class="edit-indicator">
                          <span class="material-icons">edit</span>
                          Bearbeite...
                        </span>
                      }
                    </div>
                  </td>
                  <td class="quantity">
                    <input type="number" 
                           [(ngModel)]="item.quantity" 
                           step="0.001" 
                           class="quantity-edit" 
                           (input)="onQuantityInput(item)"
                           (change)="updateItemTotal(item)"
                           (blur)="validateAndUpdateQuantity(item)">
                  </td>
                  <td class="cost-price" [title]="'EK-Preis: ‚Ç¨' + (item.cost_price || 0).toFixed(2)">‚Ç¨{{ (item.cost_price || 0).toFixed(2) }}</td>
                  <td class="customer-price">
                    @if (item.use_offer_price && item.offer_price !== undefined) {
                      <input type="number" 
                             [(ngModel)]="item.different_price" 
                             step="0.01" 
                             class="price-edit offer-price" 
                             [class.custom-price]="item.different_price !== undefined && item.different_price !== null && item.different_price !== ''"
                             (input)="onPriceInput(item)"
                             (change)="updateItemTotal(item)"
                             (blur)="validateAndUpdatePrice(item)"
                             [placeholder]="item.offer_price"
                             [title]="'Angebotspreis: ‚Ç¨' + item.offer_price + ' | Standard-Preis: ‚Ç¨' + item.sale_price">
                    } @else {
                      <input type="number" 
                             [(ngModel)]="item.different_price" 
                             step="0.01" 
                             class="price-edit" 
                             [class.custom-price]="item.different_price !== undefined && item.different_price !== null && item.different_price !== ''"
                             (input)="onPriceInput(item)"
                             (change)="updateItemTotal(item)"
                             (blur)="validateAndUpdatePrice(item)"
                             [placeholder]="item.sale_price"
                             [title]="'Standard-Preis: ‚Ç¨' + item.sale_price">
                    }
                  </td>
                  <td class="total-price">‚Ç¨{{ (getItemPrice(item) * item.quantity).toFixed(2) }}</td>
                  <td class="remove-column">
                    @if (editingItemIndex === i) {
                      <button (click)="cancelEditItem()" class="cancel-edit-btn" title="Bearbeitung abbrechen">
                        <span class="material-icons">close</span>
                      </button>
                    } @else {
                      <button (click)="confirmRemoveFromOrder(i)" class="remove-btn" title="Entfernen">
                        <span class="material-icons">delete</span>
                      </button>
                    }
                  </td>
                  <td class="ean-column">
                    @if (editingItemIndex !== i) {
                      <button class="ean-assign-btn" 
                              (click)="openEanAssignmentModal(item)"
                              title="EAN-Code zuweisen">
                        <span class="material-icons">qr_code_scanner</span>
                      </button>
                    }
                  </td>
                </tr>
                }
              </tbody>
              <tfoot>
                <tr class="order-total-row">
                  <td colspan="7" class="total-label"><strong>Gesamt:</strong></td>
                  <td class="total-amount"><strong>‚Ç¨{{ getOrderTotal().toFixed(2) }}</strong></td>
                  <td colspan="2"></td>
                </tr>
              </tfoot>
            </table>
          </div>
          
          <!-- Datumsfelder -->
          <div class="date-fields">
            <div class="date-field">
              <label for="orderDate">Bestellung:</label>
              <input type="date" 
                     id="orderDate" 
                     [(ngModel)]="orderDate" 
                     class="date-input">
            </div>
            <div class="date-field">
              <label for="deliveryDate">Lieferung:</label>
              <input type="date" 
                     id="deliveryDate" 
                     [(ngModel)]="deliveryDate" 
                     class="date-input">
            </div>
          </div>
          
          <div class="order-actions">
            <button (click)="saveOrder()" class="save-order-btn">
              <span class="material-icons">save</span>
              Auftrag speichern
            </button>
            <button (click)="confirmClearOrder()" class="clear-order-btn">
              <span class="material-icons">clear</span>
              Auftrag l√∂schen
            </button>
          </div>
          } @else {
          <div class="no-items">
            <p>Noch keine Artikel im Auftrag. Suchen Sie nach Artikeln und f√ºgen Sie sie hinzu.</p>
          </div>
          }
        </div>
        } @else {
        <div class="no-customer-selected">
          <h3>Auftragserstellung</h3>
          <p>Bitte w√§hlen Sie zuerst einen Kunden aus, um einen Auftrag zu erstellen.</p>
          <button (click)="openCustomerModal()" class="select-customer-btn">
            <span class="material-icons">people</span>
            Kunde ausw√§hlen
          </button>
        </div>
        }
      </div>

      <!-- Rechte Spalte: Artikelauswahl -->
      <div class="articles-column">
        <div class="articles-section">
          <h3>Artikelauswahl</h3>
          
          <div class="search-container">
            @if (editingItemIndex !== -1) {
              <div class="edit-mode-indicator">
                <span class="material-icons">edit</span>
                <span>Bearbeite: {{ orderItems[editingItemIndex].article_text }}</span>
                <button (click)="cancelEditItem()" class="cancel-edit-mode-btn">
                  <span class="material-icons">close</span>
                </button>
              </div>
            }
            <div class="search-and-scanner-container">
              <div class="search-input-wrapper" [class.edit-mode]="editingItemIndex !== -1">
                <input #searchInput 
                       type="text" 
                       [(ngModel)]="searchTerm" 
                       (input)="filteredArtikelData()" 
                       (keydown)="onKeyDown($event)"
                       (focus)="onSearchFocus()"
                       [placeholder]="editingItemIndex !== -1 ? 'Neuen Artikel suchen...' : 'Artikel suchen...'"
                       class="search-input">
                <button *ngIf="searchTerm" (click)="clearSearch()" class="clear-search">
                  <span class="material-icons">close</span>
                </button>
              </div>
              <button (click)="startScanner()" [disabled]="isScanning" class="scanner-btn">
                <span class="material-symbols-outlined">barcode</span>
              </button>
              <button (click)="imageInput.click()" class="upload-images-btn" [disabled]="isAnalyzingImages">
                <span class="material-icons">cloud_upload</span>
              </button>
              <button (click)="openRecentImagesModal()" class="recent-images-btn" title="Zuletzt hochgeladene Bilder anzeigen">
                <span class="material-icons">photo_library</span>
              </button>
            </div>
          </div>
          
          @if (showDropdown && filteredArtikels.length > 0) {
          <div class="articles-dropdown" #articlesDropdown>
            @for (artikel of filteredArtikels; track $index) {
            <div class="article-dropdown-item" 
                 [class.selected]="selectedIndex === $index"
                 [class.offer-item]="artikel.use_offer_price && artikel.offer_price !== undefined"
                 (click)="onArticleClick(artikel)">
              <div class="article-info">
                <div class="article-details">
                  <h4 class="article-title" [ngClass]="getArticleTitleClass(artikel.article_text)">{{ artikel.article_text }}</h4>
                  <p class="article-number">Art.-Nr: {{ artikel.article_number }}</p>
                  <p class="article-price">
                    <span class="cost-price" [title]="'EK-Preis: ‚Ç¨' + (artikel.cost_price || 0).toFixed(2)">EK: ‚Ç¨{{ (artikel.cost_price || 0).toFixed(2) }}</span>
                    @if (artikel.use_offer_price && artikel.offer_price !== undefined) {
                      <span class="customer-price offer-price">Angebot: ‚Ç¨{{ artikel.offer_price }}</span>
                      <span class="original-price">(Standard: ‚Ç¨{{ artikel.sale_price }})</span>
                    } @else if (artikel.different_price !== undefined) {
                      <span class="customer-price">Kundenpreis: ‚Ç¨{{ artikel.different_price }}</span>
                      <span class="original-price">(Standard: ‚Ç¨{{ artikel.sale_price }})</span>
                    } @else {
                      <span class="standard-price">VK: ‚Ç¨{{ artikel.sale_price }}</span>
                    }
                  </p>
                </div>
                <div class="article-actions">
                                        <input type="number" 
                             [(ngModel)]="artikel.quantity" 
                             placeholder="Menge" 
                             class="quantity-input" 
                             (click)="$event.stopPropagation()"
                             (keydown)="onQuantityInputKeyDown($event, $index)">
                  <button (click)="addToOrder($event, artikel); $event.stopPropagation()" class="add-to-order-btn">
                    <span class="material-icons">
                      {{ editingItemIndex !== -1 ? 'swap_horiz' : 'add_shopping_cart' }}
                    </span>
                  </button>
                </div>
              </div>
            </div>
            }
          </div>
          } @else if (!searchTerm) {
          <div class="no-search">
            <p>Geben Sie einen Suchbegriff ein, um Artikel zu finden.</p>
          </div>
          } @else {
          <div class="no-results">
            <p>Keine Artikel f√ºr "{{ searchTerm }}" gefunden.</p>
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Mobile Ansicht mit Tabs -->
    <div class="mobile-view">
      <!-- Kunden-Header f√ºr Mobile -->
      @if (globalService.selectedCustomerForOrders) {
      <div class="mobile-customer-header" [class.prices-tab-active]="activeTab === 'prices'">
        <div class="customer-info">
          <div class="company-name-container" 
               [class.editing]="isEditingCompanyName"
               title="Klicken zum Bearbeiten des Firmennamens">
            @if (isEditingCompanyName) {
              <input type="text" 
                     [(ngModel)]="editingCompanyName"
                     (keydown)="onCompanyNameKeyDown($event)"
                     (blur)="saveCompanyName()"
                     class="company-name-edit-input mobile-company-name-input"
                     autofocus>
            } @else {
              <h3 (click)="startEditCompanyName()">
                {{ differentCompanyName || globalService.selectedCustomerForOrders.last_name_company || globalService.selectedCustomerForOrders.customer_number }}
                @if (differentCompanyName) {
                  <span class="edit-indicator">(ge√§ndert)</span>
                }
              </h3>
            }
          </div>
          @if (globalService.selectedCustomerForOrders.name_addition) {
            <p class="customer-addition">{{ globalService.selectedCustomerForOrders.name_addition }}</p>
          }
        </div>
        <div class="customer-actions">
          <button (click)="openCustomerModal()" class="change-customer-btn">
            <span class="material-icons">swap_horiz</span>
          </button>
          <button (click)="confirmClearSelectedCustomer()" class="clear-customer-btn">
            <span class="material-icons">close</span>
          </button>
        </div>
      </div>
      } @else {
      <div class="mobile-no-customer">
        <h3>Auftragserstellung</h3>
        <button (click)="openCustomerModal()" class="select-customer-btn">
          <span class="material-icons">people</span>
          Kunde ausw√§hlen
        </button>
      </div>
      }

      <!-- Mobile Tabs -->
      <div class="mobile-tabs">
        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Tab 1: Artikel suchen -->
          <div class="tab-panel" [class.active]="activeTab === 'search'">
            <div class="mobile-search-section">
              <div class="search-container">
                @if (editingItemIndex !== -1) {
                  <div class="edit-mode-indicator">
                    <span class="material-icons">edit</span>
                    <span>Bearbeite: {{ orderItems[editingItemIndex].article_text }}</span>
                    <button (click)="cancelEditItem()" class="cancel-edit-mode-btn">
                      <span class="material-icons">close</span>
                    </button>
                  </div>
                }
                <div class="search-and-scanner-container">
                  <div class="search-input-wrapper" [class.edit-mode]="editingItemIndex !== -1">
                    <input #mobileSearchInput 
                           type="text" 
                           [(ngModel)]="searchTerm" 
                           (input)="filteredArtikelData()" 
                           (keydown)="onKeyDown($event)"
                           (focus)="onSearchFocus()"
                           [placeholder]="editingItemIndex !== -1 ? 'Neuen Artikel suchen...' : 'Artikel suchen...'"
                           class="search-input">
                    <button *ngIf="searchTerm" (click)="clearSearch()" class="clear-search">
                      <span class="material-icons">close</span>
                    </button>
                  </div>
                  <button (click)="startScanner()" [disabled]="isScanning" class="scanner-btn">
                    <span class="material-symbols-outlined">barcode</span>
                  </button>
                  <button (click)="imageInput.click()" class="upload-images-btn" [disabled]="isAnalyzingImages">
                    <span class="material-icons">cloud_upload</span>
                  </button>
                  <button (click)="openRecentImagesModal()" class="recent-images-btn" title="Zuletzt hochgeladene Bilder anzeigen">
                    <span class="material-icons">photo_library</span>
                  </button>
                </div>
              </div>
              
              @if (showDropdown && filteredArtikels.length > 0) {
              <div class="mobile-articles-dropdown" #mobileArticlesDropdown>
                @for (artikel of filteredArtikels; track $index) {
                <div class="mobile-article-dropdown-item" 
                     [class.selected]="selectedIndex === $index"
                     [class.offer-item]="artikel.use_offer_price && artikel.offer_price !== undefined"
                     (click)="onArticleClick(artikel)">
                  <div class="article-info">
                    <div class="article-details">
                      <h4 class="article-title" [ngClass]="getArticleTitleClass(artikel.article_text)">{{ artikel.article_text }}</h4>
                      <p class="article-number">Art.-Nr: {{ artikel.article_number }}</p>
                      <p class="article-price">
                        <span class="cost-price" [title]="'EK-Preis: ‚Ç¨' + (artikel.cost_price || 0).toFixed(2)">EK: ‚Ç¨{{ (artikel.cost_price || 0).toFixed(2) }}</span>
                        @if (artikel.use_offer_price && artikel.offer_price !== undefined) {
                          <span class="customer-price offer-price">Angebot: ‚Ç¨{{ artikel.offer_price }}</span>
                          <span class="original-price">(Standard: ‚Ç¨{{ artikel.sale_price }})</span>
                        } @else if (artikel.different_price !== undefined) {
                          <span class="customer-price">Kundenpreis: ‚Ç¨{{ artikel.different_price }}</span>
                          <span class="original-price">(Standard: ‚Ç¨{{ artikel.sale_price }})</span>
                        } @else {
                          <span class="standard-price">VK: ‚Ç¨{{ artikel.sale_price }}</span>
                        }
                      </p>
                    </div>
                    <div class="article-actions">
                      <input type="number" 
                             [(ngModel)]="artikel.quantity" 
                             placeholder="Menge" 
                             class="quantity-input" 
                             (click)="$event.stopPropagation()"
                             (keydown)="onQuantityInputKeyDown($event, $index)">
                      <button (click)="addToOrder($event, artikel); $event.stopPropagation()" class="add-to-order-btn">
                        <span class="material-icons">
                          {{ editingItemIndex !== -1 ? 'swap_horiz' : 'add_shopping_cart' }}
                        </span>
                      </button>
                    </div>
                  </div>
                </div>
                }
              </div>
              } @else if (!searchTerm) {
              <div class="no-search">
                <p>Geben Sie einen Suchbegriff ein, um Artikel zu finden.</p>
              </div>
              } @else {
              <div class="no-results">
                <p>Keine Artikel f√ºr "{{ searchTerm }}" gefunden.</p>
              </div>
              }
            </div>
          </div>

          <!-- Tab 2: Auftragstabelle (Kartenansicht) -->
          <div class="tab-panel" [class.active]="activeTab === 'order'">
            @if (globalService.selectedCustomerForOrders) {
              @if (orderItems.length > 0) {
              <div class="mobile-order-cards">
                @for (item of orderItems; track $index; let i = $index) {
                <div class="order-card" 
                     [class.editing]="editingItemIndex === i"
                     [class.offer-item]="item.use_offer_price && item.offer_price !== undefined"
                     [draggable]="editingItemIndex !== i && editingArticleNameIndex !== i"
                     (dragstart)="onDragStart($event, i)"
                     (dragover)="onDragOver($event)"
                     (drop)="onDrop($event, i)"
                     (dragenter)="onDragEnter($event)"
                     (dragleave)="onDragLeave($event)"
                     [class.drag-over]="dragOverIndex === i"
                     [class.dragging]="draggedIndex === i">
                  <div class="card-header">
                    <div class="position-badge">{{ i + 1 }}</div>
                    <div class="card-actions">
                      <button class="card-btn" 
                              (click)="showArticleNotes(i)"
                              title="Artikel-Notizen">
                        <span class="material-icons">info</span>
                      </button>
                      <button class="card-btn" 
                              (click)="openEanAssignmentModal(item)"
                              title="EAN-Code zuweisen">
                        <span class="material-icons">qr_code_scanner</span>
                      </button>
                      <button class="card-btn" 
                              (click)="confirmRemoveFromOrder(i)"
                              title="Entfernen">
                        <span class="material-icons">delete</span>
                      </button>
                    </div>
                  </div>
                  <div class="card-content">
                    <!-- Artikel-Header mit Name und Nummer -->
                    <div class="article-header">
                      <div class="article-name" (click)="startEditArticleName(i)">
                        @if (editingArticleNameIndex === i) {
                          <input type="text" 
                                 [(ngModel)]="editingArticleName"
                                 (keydown)="onArticleNameKeyDown($event, i)"
                                 (blur)="saveArticleName(i)"
                                 (focus)="onArticleNameFocus(i)"
                                 class="article-name-edit-input"
                                 #articleNameInput>
                        } @else {
                          {{ item.article_text }}
                        }
                      </div>
                      <div class="article-number" (click)="startEditItem(i)">
                        @if (editingItemIndex === i) {
                          <span class="edit-indicator">Bearbeite...</span>
                        } @else {
                          {{ item.article_number }}
                        }
                      </div>
                    </div>
                    
                    <!-- Preis-Informationen -->
                    <div class="price-info-section">
                      <div class="price-row">
                        <span class="price-label">EK-Preis:</span>
                        <span class="price-value cost-price">‚Ç¨{{ (item.cost_price || 0).toFixed(2) }}</span>
                      </div>
                      <div class="price-row">
                        <span class="price-label">Standard-Preis:</span>
                        <span class="price-value standard-price">‚Ç¨{{ item.sale_price }}</span>
                      </div>
                      @if (item.use_offer_price && item.offer_price !== undefined) {
                        <div class="price-row offer-price-row">
                          <span class="price-label">Angebotspreis:</span>
                          <span class="price-value offer-price">‚Ç¨{{ item.offer_price }}</span>
                        </div>
                      }
                      <div class="price-row" [class.active]="item.different_price !== undefined && item.different_price !== null && item.different_price !== ''">
                        <span class="price-label">Kundenpreis:</span>
                        <input type="number" 
                               [(ngModel)]="item.different_price" 
                               step="0.01" 
                               class="price-edit" 
                               [class.custom-price]="item.different_price !== undefined && item.different_price !== null && item.different_price !== ''"
                               (input)="onPriceInput(item)"
                               (change)="updateItemTotal(item)"
                               (blur)="validateAndUpdatePrice(item)"
                               [placeholder]="item.sale_price"
                               [title]="'Standard-Preis: ‚Ç¨' + item.sale_price">
                      </div>
                    </div>
                    
                    <!-- Menge und Gesamtpreis -->
                    <div class="quantity-total-section">
                      <div class="quantity-section">
                        <span class="quantity-label">Menge:</span>
                        <input type="number" 
                               [(ngModel)]="item.quantity" 
                               step="0.001" 
                               class="quantity-edit" 
                               (input)="onQuantityInput(item)"
                               (change)="updateItemTotal(item)"
                               (blur)="validateAndUpdateQuantity(item)">
                      </div>
                      <div class="total-section">
                        <span class="total-label">Gesamt:</span>
                        <span class="total-amount">‚Ç¨{{ (getItemPrice(item) * item.quantity).toFixed(2) }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                }
                <div class="order-total-card">
                  <div class="total-row">
                    <span class="total-label">Auftrag Gesamt:</span>
                    <span class="total-amount">‚Ç¨{{ getOrderTotal().toFixed(2) }}</span>
                  </div>
                </div>
              </div>
              
              <!-- Datumsfelder f√ºr mobile Ansicht -->
              <div class="mobile-date-fields">
                <div class="mobile-date-field">
                  <label for="mobileOrderDate">Bestellung:</label>
                  <input type="date" 
                         id="mobileOrderDate" 
                         [(ngModel)]="orderDate" 
                         class="mobile-date-input">
                </div>
                <div class="mobile-date-field">
                  <label for="mobileDeliveryDate">Lieferung:</label>
                  <input type="date" 
                         id="mobileDeliveryDate" 
                         [(ngModel)]="deliveryDate" 
                         class="mobile-date-input">
                </div>
              </div>
              
              <div class="mobile-order-actions">
                <button (click)="saveOrder()" class="save-order-btn">
                  <span class="material-icons">save</span>
                  Auftrag speichern
                </button>
                <button (click)="confirmClearOrder()" class="clear-order-btn">
                  <span class="material-icons">clear</span>
                  Auftrag l√∂schen
                </button>
              </div>
              } @else {
              <div class="no-items">
                <p>Noch keine Artikel im Auftrag. Suchen Sie nach Artikeln und f√ºgen Sie sie hinzu.</p>
              </div>
              }
            } @else {
              <div class="no-customer-selected">
                <p>Bitte w√§hlen Sie zuerst einen Kunden aus, um einen Auftrag zu erstellen.</p>
              </div>
            }
          </div>

          <!-- Tab 3: Kundenspezifische Preise -->
          <div class="tab-panel" [class.active]="activeTab === 'prices'">
            @if (globalService.selectedCustomerForOrders) {
              @if (customerArticlePrices.length > 0) {
                              <div class="mobile-customer-prices">
                  <div class="prices-header">
                    <h3>Kundenspezifische Preise</h3>
                    <p>{{ customerArticlePrices.length }} Preise verf√ºgbar</p>
                    <div class="mobile-prices-actions">
                      <button (click)="showQRCode()" class="mobile-qr-code-btn" title="QR-Code f√ºr Online-Bestellung anzeigen">
                        <span class="material-icons">qr_code</span>
                        QR-Code
                      </button>
                      <button (click)="printCustomerPrices()" class="mobile-print-btn" title="Kundenpreise drucken">
                        <span class="material-icons">print</span>
                        Drucken
                      </button>
                    </div>
                  </div>
                
                <!-- Suchfeld f√ºr kundenspezifische Preise -->
                <div class="mobile-prices-search-section">
                  <div class="prices-search-container">
                    <input type="text" 
                           [(ngModel)]="articlePricesSearchTerm" 
                           (input)="filterArticlePrices()" 
                           placeholder="Nach Artikelbezeichnung, Art.-Nr., EAN oder Produkt-ID suchen..." 
                           class="prices-search-input">
                    <button *ngIf="articlePricesSearchTerm" (click)="clearArticlePricesSearch()" class="clear-prices-search">
                      <span class="material-icons">close</span>
                    </button>
                  </div>
                </div>
                
                <div class="mobile-article-prices-cards">
                  @for (customerPrice of filteredArticlePrices; track customerPrice.product_id) {
                  <div class="mobile-article-price-card" 
                       [class.offer-item]="customerPrice.use_offer_price && customerPrice.offer_price !== undefined">
                    <div class="price-card-header">
                      <div class="price-badge" [class.offer-badge]="customerPrice.use_offer_price && customerPrice.offer_price !== undefined">
                        <span class="price-amount">‚Ç¨{{ customerPrice.unit_price_net }}</span>
                        <span class="price-label">
                          @if (customerPrice.use_offer_price && customerPrice.offer_price !== undefined) {
                            Angebotspreis
                          } @else {
                            Kundenpreis
                          }
                        </span>
                      </div>
                    </div>
                    
                    <div class="price-card-content">
                      <div class="article-info">
                        <div class="article-name">{{ sanitizeText(customerPrice.article_text || customerPrice.product_name) || 'Unbekannter Artikel' }}</div>
                        <div class="article-number">{{ customerPrice.article_number || customerPrice.product_id }}</div>
                        <!-- Debug Logging f√ºr Modal-Anzeige -->
                        <div style="display: none;" *ngIf="true">
                          {{ logModalDisplay(customerPrice) }}
                        </div>
                      </div>
                      
                      <div class="invoice-info">
                        <div class="invoice-row">
                          <span class="invoice-label">Rechnung:</span>
                          <span class="invoice-value">{{ customerPrice.invoice_id || '-' }}</span>
                        </div>
                        <div class="invoice-row">
                          <span class="invoice-label">Datum:</span>
                          <span class="invoice-value">{{ formatInvoiceDate(customerPrice.invoice_date) }}</span>
                        </div>
                      </div>
                      
                      <div class="add-to-order-section">
                        <div class="quantity-input-group">
                          <span class="quantity-label">Menge:</span>
                          <input type="number" 
                                 [(ngModel)]="customerPrice.tempQuantity" 
                                 step="0.001" 
                                 class="quantity-input" 
                                 placeholder="1"
                                 (keyup.enter)="addArticleFromPricesModal(customerPrice)">
                        </div>
                        <button (click)="addArticleFromPricesModal(customerPrice)" class="add-to-order-btn" title="Zum Auftrag hinzuf√ºgen">
                          <span class="material-icons">add_shopping_cart</span>
                          <span class="btn-text">Hinzuf√ºgen</span>
                        </button>
                      </div>
                    </div>
                  </div>
                  }
                </div>
                
                @if (articlePricesSearchTerm && filteredArticlePrices.length === 0) {
                <div class="no-prices-results">
                  <p>Keine Artikel f√ºr "{{ articlePricesSearchTerm }}" gefunden.</p>
                </div>
                }
              </div>
              } @else {
              <div class="no-customer-prices">
                <p>Keine kundenspezifischen Preise verf√ºgbar. Standard-Preise werden verwendet.</p>
              </div>
              }
            } @else {
              <div class="no-customer-selected">
                <p>Bitte w√§hlen Sie zuerst einen Kunden aus, um kundenspezifische Preise anzuzeigen.</p>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Mobile Tab Bar am unteren Bildschirmrand -->
      <div class="mobile-tab-bar">
        <button class="tab-btn" 
                [class.active]="activeTab === 'search'"
                (click)="setActiveTab('search')">
          <span class="material-icons">search</span>
          <span class="tab-label">Artikel suchen</span>
        </button>
        <button class="tab-btn" 
                [class.active]="activeTab === 'order'"
                (click)="setActiveTab('order')">
          <span class="material-icons">shopping_cart</span>
          <span class="tab-label">Auftrag ({{ orderItems.length }})</span>
        </button>
        <button class="tab-btn" 
                [class.active]="activeTab === 'prices'"
                [class.disabled]="!globalService.selectedCustomerForOrders"
                (click)="setActiveTab('prices')"
                [disabled]="!globalService.selectedCustomerForOrders">
          <span class="material-icons">price_check</span>
          <span class="tab-label">Kundenpreise</span>
          @if (customerArticlePrices.length > 0) {
            <span class="tab-badge">{{ customerArticlePrices.length }}</span>
          }
        </button>
      </div>
    </div>
  </div>

</div>

@if (isVisible) {
<app-upload-loading></app-upload-loading>
}

<!-- Scanner Modal -->
<div class="scanner-modal" *ngIf="isScanning">
  <div class="scanner-content">
    <div class="scanner-header">
      <h3>Barcode Scanner</h3>
      <button class="close-scanner" (click)="stopScanner()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    
    <select [(ngModel)]="selectedDevice" class="device-select">
      <option *ngFor="let device of availableDevices" [ngValue]="device">
        {{ device.label }}
      </option>
    </select>
    
    <div class="scanner-wrapper">
      <zxing-scanner #scanner 
      [device]="selectedDevice"
      [videoConstraints]="videoConstraints"
      [tryHarder]="true"
      [formats]="formatsEnabled"
      [torch]="true"
      (scanSuccess)="onCodeResult($event)">
      </zxing-scanner>
    </div>
  </div>
</div>

<!-- Article Prices Modal -->
<div class="article-prices-modal" *ngIf="isArticlePricesModalOpen">
  <div class="article-prices-modal-content">
    <!-- Notification -->
    @if (isArticlePricesNotificationVisible) {
    <div class="article-prices-notification">
      <span class="material-icons notification-icon">check_circle</span>
      <span class="notification-text">{{ articlePricesNotificationText }}</span>
    </div>
    }
    
    <div class="article-prices-modal-header">
      <h2>Artikel-Preise</h2>
      <button class="close-article-prices-modal" (click)="closeArticlePricesModal()">
        <span class="material-icons">close</span>
      </button>
    </div>
    
    <div class="article-prices-modal-body">
      <div class="article-prices-search">
        <input type="text" [(ngModel)]="articlePricesSearchTerm" (input)="filterArticlePrices()" placeholder="Nach Artikelbezeichnung, Art.-Nr., EAN oder Produkt-ID suchen..." class="article-prices-search-input">
      </div>
      
      <!-- Desktop Tabelle -->
      <div class="article-prices-table-container">
        <table class="article-prices-table">
          <thead>
            <tr>
              <th>Artikel</th>
              <th>Art.-Nr.</th>
              <th>Kundenpreis (‚Ç¨)</th>
              <th>Rechnungs-ID</th>
              <th>Rechnungsdatum</th>
              <th>Info</th>
              <th>Aktion</th>
            </tr>
          </thead>
          <tbody>
            @for (customerPrice of filteredArticlePrices; track customerPrice.product_id) {
            <tr class="article-price-row">
              <td class="article-name">{{ sanitizeText(customerPrice.article_text || customerPrice.product_name) || 'Unbekannter Artikel' }}</td>
              <td class="article-number">{{ customerPrice.article_number || customerPrice.product_id }}</td>
              <td class="customer-price">
                <span class="customer-price-value">‚Ç¨{{ customerPrice.unit_price_net }}</span>
              </td>
              <td class="invoice-id">{{ customerPrice.invoice_id || '-' }}</td>
              <td class="invoice-date">{{ formatInvoiceDate(customerPrice.invoice_date) }}</td>
              <td class="notes">
                <button class="info-btn" 
                        (click)="showCustomerPriceNotes(customerPrice)"
                        [title]="customerPrice.article_notes ? 'Artikel-Notizen anzeigen' : 'Keine Notizen'">
                  <span class="material-icons">info</span>
                </button>
              </td>
              <td class="action">
                <div class="add-article-controls">
                  <input type="number" 
                         [(ngModel)]="customerPrice.tempQuantity" 
                         step="0.001" 
                         class="quantity-input" 
                         placeholder="1"
                         (keyup.enter)="addArticleFromPricesModal(customerPrice)">
                  <button (click)="addArticleFromPricesModal(customerPrice)" class="add-article-btn" title="Zum Auftrag hinzuf√ºgen">
                    <span class="material-icons">add_shopping_cart</span>
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="article-prices-actions" style="margin-top: 12px; display: flex; gap: 8px; justify-content: flex-end;">
        <button (click)="showQRCode()" class="qr-code-btn" title="QR-Code f√ºr Online-Bestellung anzeigen" style="display: inline-flex; align-items: center; gap: 6px; background: #10b981; color: #fff; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">
          <span class="material-icons">qr_code</span>
          QR-Code
        </button>
        <button (click)="printCustomerPrices()" class="print-article-prices-btn" title="Kundenpreise drucken" style="display: inline-flex; align-items: center; gap: 6px; background: #2563eb; color: #fff; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">
          <span class="material-icons">print</span>
          Drucken
        </button>
      </div>
      
      <!-- Mobile Karten-Ansicht f√ºr kundenspezifische Preise -->
      <div class="article-prices-cards">
        @for (customerPrice of filteredArticlePrices; track customerPrice.product_id) {
        <div class="article-price-card">
          <div class="price-card-header">
            <div class="price-badge">
              <span class="price-amount">‚Ç¨{{ customerPrice.unit_price_net }}</span>
              <span class="price-label">Kundenpreis</span>
            </div>
            <div class="card-actions">
              <button class="info-btn" (click)="showCustomerPriceNotes(customerPrice)" title="Artikel-Notizen anzeigen">
                <span class="material-icons">info</span>
              </button>
            </div>
          </div>
          
          <div class="price-card-content">
            <div class="article-info">
              <div class="article-name">{{ sanitizeText(customerPrice.article_text || customerPrice.product_name) || 'Unbekannter Artikel' }}</div>
              <div class="article-number">{{ customerPrice.article_number || customerPrice.product_id }}</div>
            </div>
            
            <div class="invoice-info">
              <div class="invoice-row">
                <span class="invoice-label">Rechnung:</span>
                <span class="invoice-value">{{ customerPrice.invoice_id || '-' }}</span>
              </div>
              <div class="invoice-row">
                <span class="invoice-label">Datum:</span>
                <span class="invoice-value">{{ formatInvoiceDate(customerPrice.invoice_date) }}</span>
              </div>
            </div>
            
            <div class="add-to-order-section">
              <div class="quantity-input-group">
                <span class="quantity-label">Menge:</span>
                              <input type="number" 
                     [(ngModel)]="customerPrice.tempQuantity" 
                     class="quantity-input" 
                     placeholder="1"
                     (keyup.enter)="addArticleFromPricesModal(customerPrice)">
              </div>
              <button (click)="addArticleFromPricesModal(customerPrice)" class="add-to-order-btn" title="Zum Auftrag hinzuf√ºgen">
                <span class="material-icons">add_shopping_cart</span>
                <span class="btn-text">Hinzuf√ºgen</span>
              </button>
            </div>
          </div>
        </div>
        }
      </div>
      
      @if (filteredArticlePrices.length === 0) {
      <div class="no-article-prices">
        <p>Keine Artikel gefunden.</p>
      </div>
      }
    </div>
  </div>
</div>

<!-- Customer Modal -->
<div class="customer-modal" *ngIf="isCustomerModalOpen">
  <div class="customer-modal-content">
    <div class="customer-modal-header">
      <h2>Kundenliste</h2>
      <button class="close-customer-modal" (click)="closeCustomerModal()">
        <span class="material-icons">close</span>
      </button>
    </div>
    
    <div class="customer-modal-body">
      <div class="customer-search">
        <input type="text" [(ngModel)]="customerSearchTerm" (input)="filterCustomers()" placeholder="Kunden suchen..." class="customer-search-input">
      </div>
      
      <div class="customers-grid">
        @for (customer of filteredCustomers; track customer.id) {
        <div class="customer-card">
          <div class="customer-card-header">
            <h3>{{ customer.customer_number }}</h3>
          </div>
          <div class="customer-card-body">
            <p class="customer-name"><strong>{{ customer.last_name_company || 'Kein Name' }}</strong></p>
            <p class="customer-addition" *ngIf="customer.name_addition">{{ customer.name_addition }}</p>
            @if (customer.street || customer.postal_code || customer.city) {
              <p class="customer-address">
                @if (customer.street) {
                  {{ customer.street }}<br>
                }
                @if (customer.postal_code || customer.city) {
                  @if (customer.postal_code) {
                    {{ customer.postal_code }}
                  }
                  @if (customer.city) {
                    {{ customer.city }}
                  }
                }
              </p>
            }
          </div>
          <div class="customer-card-footer">
            <button class="select-customer-btn" (click)="selectCustomer(customer)">
              <span class="material-icons">check</span>
              Ausw√§hlen
            </button>
          </div>
        </div>
        }
      </div>
      
      @if (isLoadingCustomers) {
      <div class="customer-loading">
        <div class="loader"></div>
        <p>Kunden werden geladen...</p>
      </div>
      }
      
      @if (!isLoadingCustomers && filteredCustomers.length === 0) {
      <div class="no-customers">
        <p>Keine Kunden gefunden.</p>
      </div>
      }
    </div>
  </div>
</div>

<!-- Order Confirmation Modal -->
<div class="order-confirmation-modal" *ngIf="isOrderConfirmationModalOpen">
  <div class="order-confirmation-modal-content">
    <div class="order-confirmation-modal-header">
      <h2>üìã Auftrag best√§tigen</h2>
      <button class="close-order-confirmation-modal" (click)="closeOrderConfirmationModal()">
        <span class="material-icons">close</span>
      </button>
    </div>
    
    <div class="order-confirmation-modal-body">
      @if (orderConfirmationData) {
        <div class="confirmation-content">
          <!-- Kunde -->
          <div class="confirmation-section">
            <h3>üë§ Kunde</h3>
            <p class="customer-name">{{ orderConfirmationData.customerName }}</p>
          </div>

          <!-- Artikel -->
          <div class="confirmation-section">
            <h3>üì¶ Artikel</h3>
            <div class="order-items-list">
              @for (item of orderItems; track $index) {
                <div class="order-item-row">
                  <span class="item-quantity">{{ item.quantity }}x</span>
                  <span class="item-name">{{ item.article_text }}</span>
                  <span class="item-total">‚Ç¨{{ ((item.different_price !== undefined ? item.different_price : item.sale_price) * item.quantity).toFixed(2) }}</span>
                </div>
              }
            </div>
          </div>

          <!-- Datumsfelder -->
          @if (orderConfirmationData.orderDate || orderConfirmationData.deliveryDate) {
            <div class="confirmation-section">
              <h3>üìÖ Termine</h3>
              @if (orderConfirmationData.orderDate) {
                <div class="date-row">
                  <span class="date-label">Bestelldatum:</span>
                  <span class="date-value">{{ orderConfirmationData.orderDate }}</span>
                </div>
              }
              @if (orderConfirmationData.deliveryDate) {
                <div class="date-row">
                  <span class="date-label">Lieferdatum:</span>
                  <span class="date-value">{{ orderConfirmationData.deliveryDate }}</span>
                </div>
              }
            </div>
          }

          <!-- Warnung bei Verkauf unter EK-Preis -->
          @if (orderConfirmationData.itemsBelowCost && orderConfirmationData.itemsBelowCost.length > 0) {
            <div class="confirmation-section warning-section">
              <h3>‚ö†Ô∏è Warnung</h3>
              <div class="warning-content">
                <p>Folgende Artikel werden unter dem Einkaufspreis verkauft:</p>
                @for (item of orderConfirmationData.itemsBelowCost; track $index) {
                  <div class="warning-item">
                    <span class="warning-item-name">{{ item.article_text }}</span>
                    <span class="warning-item-prices">
                      (VK: ‚Ç¨{{ (item.different_price !== undefined ? item.different_price : item.sale_price).toFixed(2) }} < EK: ‚Ç¨{{ item.cost_price.toFixed(2) }})
                    </span>
                  </div>
                }
              </div>
            </div>
          }

          <!-- Gesamtpreis -->
          <div class="confirmation-section total-section">
            <div class="total-row">
              <span class="total-label">Gesamtpreis:</span>
              <span class="total-amount">‚Ç¨{{ orderConfirmationData.totalPrice.toFixed(2) }}</span>
            </div>
          </div>
        </div>
      }
    </div>
    
    <div class="order-confirmation-modal-footer">
      <button class="cancel-order-btn" (click)="closeOrderConfirmationModal()">
        <span class="material-icons">close</span>
        Abbrechen
      </button>
      <button class="confirm-order-btn" (click)="confirmOrderSave()">
        <span class="material-icons">save</span>
        Auftrag speichern
      </button>
    </div>
  </div>
</div>

<!-- EAN Assignment Modal -->
<div class="ean-assignment-modal" *ngIf="isEanAssignmentModalOpen">
  <div class="ean-assignment-modal-content">
    <div class="ean-assignment-modal-header">
      <h2>EAN-Code zuweisen</h2>
      <button class="close-ean-assignment-modal" (click)="closeEanAssignmentModal()">
        <span class="material-icons">close</span>
      </button>
    </div>
    
    <div class="ean-assignment-modal-body">
      <div class="article-info">
        <h3>{{ eanAssignmentItem?.article_text }}</h3>
        <p><strong>Artikelnummer:</strong> {{ eanAssignmentItem?.article_number }}</p>
        @if (eanAssignmentItem?.ean) {
          <p><strong>Aktuelle EAN:</strong> {{ eanAssignmentItem.ean }}</p>
        }
      </div>
      
      <!-- Existing EANs Section -->
      <div class="existing-eans-section">
        <h4>Bereits zugeordnete EAN-Codes:</h4>
        @if (isLoadingEans) {
          <div class="loading-eans">
            <div class="loader"></div>
            <p>EANs werden geladen...</p>
          </div>
        } @else if (existingEans.length > 0) {
          <div class="existing-eans-list">
            @for (eanItem of existingEans; track eanItem.id) {
              <div class="ean-item">
                <span class="ean-code">{{ eanItem.ean }}</span>
                <button (click)="removeEanFromItem(eanItem)" 
                        class="remove-ean-btn"
                        title="EAN entfernen">
                  <span class="material-icons">delete</span>
                </button>
              </div>
            }
          </div>
        } @else {
          <p class="no-eans">Keine EAN-Codes zugeordnet</p>
        }
      </div>
      
      <div class="ean-input-section">
        <div class="ean-input-group">
          <label for="eanCode">EAN-Code (8 oder 13 Ziffern):</label>
          <div class="ean-input-container">
            <input type="text" 
                   id="eanCode"
                   #eanCodeInput
                   [(ngModel)]="eanCode" 
                   placeholder="EAN-Code eingeben oder scannen..."
                   class="ean-input"
                   maxlength="13"
                   (input)="onEanInput($event)"
                   (keyup.enter)="assignEan()">
            <button (click)="startEanScanner()" 
                    [disabled]="isEanScanning" 
                    class="scanner-btn"
                    title="EAN-Code scannen">
              <span class="material-icons">qr_code_scanner</span>
            </button>
          </div>
        </div>
        
        @if (isEanScanning) {
          <div class="ean-scanner-section">
            <zxing-scanner 
              #eanScanner
              [enable]="isEanScanning"
              [formats]="formatsEnabled"
              [device]="selectedDevice"
              (scanSuccess)="onEanCodeResult($event)">
            </zxing-scanner>
            <button (click)="stopEanScanner()" class="stop-scanner-btn">
              <span class="material-icons">stop</span>
              Scanner stoppen
            </button>
          </div>
        }
      </div>
      
      @if (eanErrorMessage) {
        <div class="ean-error-message">
          <span class="material-icons">error</span>
          {{ eanErrorMessage }}
        </div>
      }
      
      @if (eanSuccessMessage) {
        <div class="ean-success-message">
          <span class="material-icons">check_circle</span>
          {{ eanSuccessMessage }}
        </div>
      }
      
      <div class="ean-assignment-actions">
        <button (click)="assignEan()" 
                [disabled]="!eanCode.trim() || !isValidEanCode(eanCode) || isAssigningEan" 
                class="assign-ean-btn">
          <span class="material-icons">save</span>
          EAN zuweisen
        </button>
        <button (click)="closeEanAssignmentModal()" class="cancel-ean-btn">
          <span class="material-icons">close</span>
          Abbrechen
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Mobile/Tablet Toast -->
<div class="mobile-toast" 
     [class.visible]="isMobileToastVisible"
     [class.hidden]="!isMobileToastVisible">
  <div class="mobile-toast-content">
    <span class="mobile-toast-text">{{ mobileToastText }}</span>
    <button class="mobile-toast-close" (click)="hideMobileToast()">
      <span class="material-icons">close</span>
    </button>
  </div>
</div>
