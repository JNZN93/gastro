<div class="open-invoices-dashboard">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <svg class="dashboard-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
        </svg>
        Offene Rechnungen
      </h1>
      <button class="upload-toggle-btn" (click)="toggleUploadModal()">
        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
        </svg>
        Rechnung hochladen
      </button>
    </div>
  </div>

  <!-- Navigation Info -->
  <div class="nav-info">
    <div class="nav-hint">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <span><strong>Tab:</strong> Zwischen Feldern navigieren • <strong>Enter:</strong> Nächste Zeile • <strong>Pfeiltasten:</strong> Navigation</span>
    </div>
  </div>

  <!-- Invoices Section -->
  <div class="invoices-section">
    <div class="section-header">
      <h2 class="section-title">Rechnungsübersicht</h2>
      <div class="table-controls">
        <div class="search-box">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <input type="text" placeholder="Rechnungen durchsuchen..." [(ngModel)]="searchTerm" class="search-input">
        </div>
      </div>
    </div>

    <div class="table-container">
      <table class="invoices-table">
        <thead>
          <tr>
            <th>Rechnungsnummer</th>
            <th>Datum</th>
            <th>Fällig am</th>
            <th>Kunde</th>
            <th>Kundennummer</th>
            <th>Betrag</th>
            <th>Status</th>
            <th>Anhang</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let invoice of filteredInvoices; let i = index; trackBy: trackByInvoiceId"
              class="invoice-row"
              [class.selected-row]="selectedRow === i">
            <!-- Rechnungsnummer -->
            <td class="invoice-cell"
                [class.selected-cell]="selectedRow === i && selectedCol === 0"
                (click)="selectCell(i, 0)">
              <input type="text"
                     [(ngModel)]="invoice.invoiceNumber"
                     class="editable-input"
                     (input)="updateInvoiceField(invoice, 'invoiceNumber', $any($event.target).value)"
                     [class.focused]="selectedRow === i && selectedCol === 0">
            </td>

            <!-- Datum -->
            <td class="invoice-cell"
                [class.selected-cell]="selectedRow === i && selectedCol === 1"
                (click)="selectCell(i, 1)">
              <input type="date"
                     [(ngModel)]="invoice.date"
                     class="editable-input"
                     (input)="updateInvoiceField(invoice, 'date', $any($event.target).value)"
                     [class.focused]="selectedRow === i && selectedCol === 1">
            </td>

            <!-- Fälligkeitsdatum -->
            <td class="invoice-cell"
                [class.selected-cell]="selectedRow === i && selectedCol === 2"
                (click)="selectCell(i, 2)">
              <input type="date"
                     [(ngModel)]="invoice.dueDate"
                     class="editable-input"
                     (input)="updateInvoiceField(invoice, 'dueDate', $any($event.target).value)"
                     [class.focused]="selectedRow === i && selectedCol === 2">
            </td>

            <!-- Kundenname -->
            <td class="invoice-cell"
                [class.selected-cell]="selectedRow === i && selectedCol === 3"
                (click)="selectCell(i, 3)">
              <input type="text"
                     [(ngModel)]="invoice.customerName"
                     class="editable-input"
                     (input)="updateInvoiceField(invoice, 'customerName', $any($event.target).value)"
                     [class.focused]="selectedRow === i && selectedCol === 3">
            </td>

            <!-- Kundennummer -->
            <td class="invoice-cell"
                [class.selected-cell]="selectedRow === i && selectedCol === 4"
                (click)="selectCell(i, 4)">
              <input type="text"
                     [(ngModel)]="invoice.customerNumber"
                     class="editable-input"
                     (input)="updateInvoiceField(invoice, 'customerNumber', $any($event.target).value)"
                     [class.focused]="selectedRow === i && selectedCol === 4">
            </td>

            <!-- Betrag -->
            <td class="invoice-cell"
                [class.selected-cell]="selectedRow === i && selectedCol === 5"
                (click)="selectCell(i, 5)">
              <input type="number"
                     step="0.01"
                     [(ngModel)]="invoice.amount"
                     class="editable-input"
                     (input)="updateInvoiceField(invoice, 'amount', $any($event.target).value)"
                     [class.focused]="selectedRow === i && selectedCol === 5">
            </td>

            <!-- Status -->
            <td class="status-cell"
                [class.selected-cell]="selectedRow === i && selectedCol === 6"
                (click)="selectCell(i, 6)">
              <select [(ngModel)]="invoice.status"
                      class="status-select"
                      [class]="getStatusClass(invoice.status)"
                      (change)="updateInvoiceField(invoice, 'status', $any($event.target).value)"
                      [class.focused]="selectedRow === i && selectedCol === 6">
                <option value="offen">Offen</option>
                <option value="bezahlt">Bezahlt</option>
                <option value="überfällig">Überfällig</option>
              </select>
            </td>

            <!-- Anhang -->
            <td class="attachment-cell">
              <div class="attachment-info">
                <svg *ngIf="invoice.fileName" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="attachment-icon">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                </svg>
                <span *ngIf="invoice.fileName" class="file-name">{{ invoice.fileName }}</span>
                <span *ngIf="!invoice.fileName" class="no-file">-</span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Summary Stats -->
    <div class="summary-stats">
      <div class="stat-item">
        <span class="stat-label">Gesamt Rechnungen:</span>
        <span class="stat-value">{{ filteredInvoices.length }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Offene Rechnungen:</span>
        <span class="stat-value">{{ openInvoicesCount }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Überfällige:</span>
        <span class="stat-value">{{ overdueInvoicesCount }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Gesamtbetrag offen:</span>
        <span class="stat-value">{{ formatCurrency(totalOpenAmount) }}</span>
      </div>
    </div>
  </div>

  <!-- Upload Modal -->
  <div class="modal-overlay" [class.active]="showUploadModal" (click)="toggleUploadModal()"></div>
  <div class="upload-modal" [class.active]="showUploadModal">
    <div class="modal-header">
      <h2>Rechnung hochladen</h2>
      <button class="close-btn" (click)="toggleUploadModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <div class="modal-content">
      <div class="upload-section">
        <div class="upload-info">
          <h3>Rechnungsdatei auswählen</h3>
          <p>Wählen Sie eine PDF- oder Bilddatei Ihrer Rechnung aus</p>
        </div>

        <input #fileInput type="file" id="invoiceFile" accept=".pdf,.jpg,.jpeg,.png" class="file-input" (change)="onFileSelected($event)" />

        <label for="invoiceFile" class="file-label" [class.file-selected]="selectedFileName">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="upload-icon">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
          </svg>
          <span>{{ selectedFileName || 'Datei auswählen' }}</span>
        </label>

        <button class="upload-btn" [disabled]="!selectedFile" (click)="uploadInvoice()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="btn-icon">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
          </svg>
          Rechnung hochladen
        </button>
      </div>
    </div>
  </div>
</div>
