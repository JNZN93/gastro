<header>
    <a routerLink="/" ><img src="logo.png" alt="logo"></a>

    <!-- Für nicht eingeloggte Benutzer -->
    @if(globalService.isUserLoggedIn === false && !shouldHideElement()) {
        <div class="login-container">
            <div (click)="openLoginModal()" class="login-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Anmelden</span>
            </div>
        </div>
    }

    <!-- Warenkorb und Hamburger Menu für eingeloggte Benutzer -->
    @if (globalService.isUserLoggedIn === true && !shouldHideElement()) {
        <div class="user-actions">
            <!-- Warenkorb nur wenn nicht auf Admin-Seite -->
            @if (!shouldHideElementAdmin()) {
                <div class="burger-button" (click)="toggleWarenkorb()">
                    <img src="shoppingcart.png" alt="">
                    @if (this.globalService.warenkorb.length > 0) {
                        <div class="cart-badge">{{ this.globalService.warenkorb.length }}</div>
                    }
                </div>
            }
            
            <!-- Hamburger Menu Button -->
            <div class="hamburger-menu" (click)="toggleSideModal()">
                <div class="hamburger-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    }
</header>

<!-- Side Modal für Dashboard und Abmelden -->
@if (showSideModal && globalService.isUserLoggedIn === true) {
<div class="side-modal-overlay" (click)="closeSideModal()">
    <div class="side-modal" (click)="$event.stopPropagation()">
        <div class="side-modal-header">
            <h3>Menü</h3>
            <button class="close-side-modal" (click)="closeSideModal()">×</button>
        </div>
        
        <!-- Benutzerinformation -->
        <div class="user-info">
            <div class="user-avatar">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="user-details">
                <div class="user-name">{{ globalService.getUserName() }}</div>
                <div class="user-role">{{ globalService.getUserRole() === 'admin' ? 'Administrator' : globalService.getUserRole() === 'employee' ? 'Mitarbeiter' : 'Kunde' }}</div>
            </div>
        </div>
        
        <div class="side-modal-content">
            @if (this.globalService.isAdmin || this.globalService.getUserRole() === 'employee') {
                @if (!shouldHideElementAdmin()) {
                    <div class="side-modal-item" (click)="navigateToAdmin(); closeSideModal()">
                        <img src="dashboard.png" alt="">
                        <span>Dashboard</span>
                    </div>
                }
            }
            
            <div class="side-modal-item" (click)="openModal(); closeSideModal()">
                <img src="logout.png" alt="">
                <span>Abmelden</span>
            </div>
        </div>
    </div>
</div>
}

@if (showModal) {
<div class="modal-overlay">
    <div class="modal">
        <p>Möchten Sie sich wirklich abmelden?</p>
        <button (click)="logOut()">Ja, abmelden</button>
        <button (click)="goBack()">Abbrechen</button>
    </div>
</div>
}

<!-- Login Modal -->
@if (showLoginModal) {
<div class="login-modal-overlay" (click)="closeLoginModal()">
    <div class="login-modal-content" (click)="$event.stopPropagation()">
        <button class="close-button" (click)="closeLoginModal()">×</button>
        
        <!-- Login Form -->
        <div [class.hidden]="!isLoginMode" class="form-container">
            <div class="form-header">
                <h2>Willkommen zurück</h2>
                <p>Melden Sie sich mit Ihren Zugangsdaten an</p>
            </div>

            <form [formGroup]="loginForm" (ngSubmit)="handleLogin()" class="form">
                <div class="input-group">
                    <input type="email" formControlName="email" placeholder=" " required>
                    <label>E-Mail-Adresse</label>
                </div>

                <div class="input-group">
                    <input [type]="passwordVisible ? 'text' : 'password'" formControlName="password" placeholder=" " required>
                    <label>Passwort</label>
                    <button type="button" class="toggle-password" (click)="togglePassword()">
                        <img [src]="currentImage" alt="toggle password">
                    </button>
                </div>

                <div class="form-actions">
                    <button type="submit" class="submit-btn" [disabled]="loginForm.invalid">
                        Anmelden
                        <span class="btn-arrow">→</span>
                    </button>
                </div>

                <div class="form-footer">
                    <a (click)="forgotPassword()">Passwort vergessen?</a>
                </div>
            </form>

            <div class="switch-mode">
                <p>Noch kein Konto? <a (click)="toggleMode()">Jetzt registrieren</a></p>
            </div>
        </div>

        <!-- Registration Form -->
        <div [class.hidden]="isLoginMode" class="form-container">
            <div class="form-header">
                <h2>Account erstellen</h2>
                <p>Registrieren Sie sich für ein neues Konto</p>
            </div>

            <form [formGroup]="registerForm" (ngSubmit)="handleRegistration()" class="form">
                <div class="input-group">
                    <input type="text" formControlName="name" placeholder=" " required>
                    <label>Name</label>
                </div>

                <div class="input-group">
                    <input type="text" formControlName="company" placeholder=" ">
                    <label>Firma (optional)</label>
                </div>

                <div class="input-group">
                    <input type="email" formControlName="email" placeholder=" " required>
                    <label>E-Mail-Adresse</label>
                </div>

                <div class="input-group">
                    <input [type]="passwordVisible ? 'text' : 'password'" formControlName="password" placeholder=" " required>
                    <label>Passwort</label>
                    <button type="button" class="toggle-password" (click)="togglePassword()">
                        <img [src]="currentImage" alt="toggle password">
                    </button>
                </div>

                <div class="input-group">
                    <input [type]="confirmPasswordVisible ? 'text' : 'password'" formControlName="confirmPassword" placeholder=" " required>
                    <label>Passwort bestätigen</label>
                    <button type="button" class="toggle-password" (click)="toggleConfirmPassword()">
                        <img [src]="currentImageConfirm" alt="toggle password">
                    </button>
                </div>

                <div class="form-actions">
                    <button type="submit" class="submit-btn" [disabled]="registerForm.invalid">
                        Registrieren
                        <span class="btn-arrow">→</span>
                    </button>
                </div>
            </form>

            <div class="switch-mode">
                <p>Bereits ein Konto? <a (click)="toggleMode()">Jetzt anmelden</a></p>
            </div>
        </div>

        <!-- Error Message -->
        @if(errorMessage) {
        <div class="error-message">
            <span>{{ errorMessage }}</span>
        </div>
        }
    </div>
</div>
}