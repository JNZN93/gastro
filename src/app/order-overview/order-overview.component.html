<div class="order-overview-container">
  <!-- Back Button Section -->
  <div class="back-button-section">
    <div class="back-buttons">
      <button class="back-btn" (click)="goBack()">
        <svg class="back-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Zurück
      </button>

      <button class="customer-orders-btn" (click)="goToCustomerOrders()">
        <span class="material-icons">view_list</span>
        Neuen Auftrag erstellen
      </button>
    </div>
  </div>

  <!-- Header Section -->
  <div class="overview-header">
    <div class="header-content">
      <h1 class="overview-title">
        <svg class="overview-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
        </svg>
        Bestellungsübersicht
      </h1>
      <div class="header-stats">
        <div class="stat-item">
          <span class="stat-number">{{ filteredOrders.length }}</span>
          <span class="stat-label">
            @if (dateFrom || dateTo || searchTerm) {
              Gefilterte Bestellungen
            } @else {
              Gesamt Bestellungen
            }
          </span>
        </div>
      </div>
      <div class="header-actions">
        @if (isAdmin()) {
          <button class="delete-all-btn" (click)="deleteAllOrders()" [disabled]="orders.length === 0">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
            Alle löschen
          </button>
        }
      </div>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-filter-section">
    <div class="search-container">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
      <input 
        type="text" 
        placeholder="Bestellungen durchsuchen..." 
        [(ngModel)]="searchTerm" 
        class="search-input"
      >
    </div>
    <div class="date-filter-container">
      <svg class="calendar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" (click)="focusDateInput('dateFrom')">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
      <div class="date-input-wrapper">
        <input 
          type="date" 
          id="dateFrom"
          [(ngModel)]="dateFrom" 
          (ngModelChange)="onDateFromChange($event)"
          class="date-input"
          placeholder="Von"
          #dateFromInput
          (click)="openDatePicker('dateFrom')"
        >
      </div>
      <span class="date-separator">bis</span>
      <div class="date-input-wrapper">
        <input 
          type="date" 
          id="dateTo"
          [(ngModel)]="dateTo" 
          (ngModelChange)="onDateToChange($event)"
          class="date-input"
          placeholder="Bis"
          #dateToInput
          (click)="openDatePicker('dateTo')"
        >
      </div>
      @if (dateFrom || dateTo) {
        <button class="clear-date-filter-btn" (click)="clearDateFilter()" title="Datumfilter zurücksetzen">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      }
    </div>
    <button class="reload-btn" (click)="reloadOrders()" [disabled]="isLoading" title="Bestellungen aktualisieren">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" [class.spinning]="isLoading">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
      </svg>
      Aktualisieren
    </button>
    <button 
      class="toggle-archived-btn" 
      [class.active]="showArchived"
      (click)="toggleArchived()" 
      title="Archivierte Bestellungen ein-/ausblenden">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
      </svg>
      @if (showArchived) {
        Archivierte verbergen
      } @else {
        Archivierte anzeigen
      }
    </button>
  </div>

  <!-- Orders Table -->
  <div class="table-section">
    @if (isLoading) {
      <div class="loading-container">
        <div class="loading-spinner">
          <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
          <span>Lade Bestellungen...</span>
        </div>
      </div>
    } @else {
      <!-- Desktop Table View -->
      <div class="table-container desktop-view">
        <table class="orders-table">
          <thead>
            <tr>
              <th class="sortable-header" (click)="sortByColumn('order_id')">
                <span class="header-text">Bestellnummer</span>
                @if (isSortColumn('order_id')) {
                  <span class="sort-icon">{{ getSortIcon('order_id') }}</span>
                }
              </th>
              <th class="sortable-header" (click)="sortByColumn('order_date')">
                <span class="header-text">Datum</span>
                @if (isSortColumn('order_date')) {
                  <span class="sort-icon">{{ getSortIcon('order_date') }}</span>
                }
              </th>
              <th class="sortable-header" (click)="sortByColumn('customer_number')">
                <span class="header-text">Kundennummer</span>
                @if (isSortColumn('customer_number')) {
                  <span class="sort-icon">{{ getSortIcon('customer_number') }}</span>
                }
              </th>
              <th>Sachbearbeiter</th>
              <th class="sortable-header" (click)="sortByColumn('customer_name')">
                <span class="header-text">Kunde</span>
                @if (isSortColumn('customer_name')) {
                  <span class="sort-icon">{{ getSortIcon('customer_name') }}</span>
                }
              </th>
              <th class="sortable-header" (click)="sortByColumn('status')">
                <span class="header-text">Status</span>
                @if (isSortColumn('status')) {
                  <span class="sort-icon">{{ getSortIcon('status') }}</span>
                }
              </th>
              <th class="sortable-header" (click)="sortByColumn('total_price')">
                <span class="header-text">Gesamtpreis <span style="font-size: 0.7em;">(Brutto)</span></span>
                @if (isSortColumn('total_price')) {
                  <span class="sort-icon">{{ getSortIcon('total_price') }}</span>
                }
              </th>
              <th>Aktionen</th>
            </tr>
          </thead>
          <tbody>
            @for (order of filteredOrders; track order.order_id) {
              <tr class="order-row" (click)="openDetailsAfterReload(order)">
                <td class="order-id">{{ order.order_id }}</td>
                <td class="order-date">{{ order.order_date | date: 'dd.MM.yyyy' }}</td>
                <td class="customer-number">{{ order.customer_number || '-' }}</td>
                <td class="employee-name">{{ getEmployeeDisplayName(order) }}</td>
                <td class="customer-name" [title]="getCustomerDisplayName(order)">{{ getCustomerDisplayName(order) }}</td>
                <td class="status-cell">
                  <span class="status-badge" [class]="getStatusClass(order.status)">
                    {{ getStatusText(order.status) }}
                  </span>
                </td>
                <td class="total-price">{{ getOrderTotalGross(order) | currency:'EUR':'symbol':'1.2-2' }}</td>
                <td class="actions-cell">
                  <div class="action-buttons">
                    <button class="view-btn" (click)="openDetailsAfterReload(order); $event.stopPropagation()">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                      </svg>
                      Details
                    </button>
                    <button class="print-btn" (click)="printAfterReload(order); $event.stopPropagation()" title="Kommissionierungsschein drucken">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                      </svg>
                      Drucken
                    </button>
                    @if (isOrderEditable(order)) {
                      <button class="edit-btn" (click)="editOrderAfterReload(order); $event.stopPropagation()" title="Bestellung bearbeiten">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        Bearbeiten
                      </button>
                    }
                    <button class="delete-btn" (click)="deleteOrder(order); $event.stopPropagation()">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                      </svg>
                      Löschen
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div class="cards-container mobile-view">
        @for (order of filteredOrders; track order.order_id) {
        <div class="order-card" (click)="openDetailsAfterReload(order)">
          <div class="card-header">
            <div class="order-info">
              <h3 class="order-id">#{{ order.order_id }}</h3>
              <span class="order-date">{{ order.order_date | date: 'dd.MM.yyyy' }}</span>
            </div>
            <span class="status-badge" [class]="getStatusClass(order.status)">
              {{ getStatusText(order.status) }}
            </span>
          </div>
          
          <div class="card-body">
            <div class="info-row">
              <span class="info-label">Kundennummer:</span>
              <span class="info-value">{{ order.customer_number || '-' }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Sachbearbeiter:</span>
              <span class="info-value">{{ getEmployeeDisplayName(order) }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Kunde:</span>
              <span class="info-value" [title]="getCustomerDisplayName(order)">{{ getCustomerDisplayName(order) }}</span>
            </div>
            <div class="info-row total-row">
              <span class="info-label">Gesamtpreis:</span>
              <span class="info-value total-price">{{ getOrderTotalGross(order) | currency:'EUR':'symbol':'1.2-2' }}</span>
            </div>
          </div>
          
          <div class="card-actions" (click)="$event.stopPropagation()">
            <button class="view-btn" (click)="openDetailsAfterReload(order)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
              Details
            </button>
            <button class="print-btn" (click)="printAfterReload(order)" title="Kommissionierungsschein drucken">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
              </svg>
              Drucken
            </button>
            @if (isOrderEditable(order)) {
              <button class="edit-btn" (click)="editOrderAfterReload(order)" title="Bestellung bearbeiten">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                Bearbeiten
              </button>
            }
            <button class="delete-btn" (click)="deleteOrder(order)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
              Löschen
            </button>
          </div>
        </div>
        }
      </div>

      @if (filteredOrders.length === 0) {
        <div class="no-results">
          <svg class="no-results-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33"/>
          </svg>
          <h3>Keine Bestellungen gefunden</h3>
          <p>Versuchen Sie einen anderen Suchbegriff oder laden Sie die Seite neu.</p>
        </div>
      }
      }

  <!-- Delete Confirmation Modal -->
  @if (showDeleteModal) {
    <div class="modal-overlay" (click)="cancelDelete()">
      <div class="delete-modal-content" (click)="$event.stopPropagation()">
        <div class="delete-modal-header">
          <h2>Bestellung löschen</h2>
          <button class="close-btn" (click)="cancelDelete()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        
        <div class="delete-modal-body">
          <div class="warning-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
            </svg>
          </div>
          
          <h3>Sind Sie sicher?</h3>
          <p>Die Bestellung <strong>#{{ orderToDelete?.order_id }}</strong> wird unwiderruflich gelöscht.</p>
          <p class="warning-text">Diese Aktion kann nicht rückgängig gemacht werden.</p>
          
          <div class="confirmation-input">
            <label for="deleteConfirmation">Geben Sie <strong>{{ orderToDelete?.order_id }}</strong> ein, um die Löschung zu bestätigen:</label>
            <input 
              type="text" 
              id="deleteConfirmation"
              [(ngModel)]="deleteConfirmationText" 
              placeholder="Bestellnummer eingeben..."
              class="confirmation-input-field"
              [class.error]="showConfirmationError"
            >
            @if (showConfirmationError) {
              <span class="error-message">Bestellnummer stimmt nicht überein</span>
            }
          </div>
        </div>
        
        <div class="delete-modal-footer">
          <button class="btn-secondary" (click)="cancelDelete()">Abbrechen</button>
          <button class="btn-danger" (click)="confirmDelete()" [disabled]="isDeleting || !isConfirmationValid()">
            @if (isDeleting) {
              <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
              Wird gelöscht...
            } @else {
              Bestellung löschen
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Delete All Orders Confirmation Modal -->
  @if (showDeleteAllModal) {
    <div class="modal-overlay" (click)="cancelDeleteAll()">
      <div class="delete-modal-content" (click)="$event.stopPropagation()">
        <div class="delete-modal-header">
          <h2>Alle Bestellungen löschen</h2>
          <button class="close-btn" (click)="cancelDeleteAll()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        
        <div class="delete-modal-body">
          <div class="warning-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
            </svg>
          </div>
          
          <h3>WARNUNG: Kritische Aktion!</h3>
          <p>Sie sind dabei, <strong>alle {{ orders.length }} Bestellungen</strong> unwiderruflich zu löschen.</p>
          <p class="warning-text">Diese Aktion kann nicht rückgängig gemacht werden und betrifft alle Bestellungen im System.</p>
          
          <div class="confirmation-input">
            <label for="deleteAllConfirmation">Geben Sie <strong>ALLE LÖSCHEN</strong> ein, um die Löschung aller Bestellungen zu bestätigen:</label>
            <input 
              type="text" 
              id="deleteAllConfirmation"
              [(ngModel)]="deleteAllConfirmationText" 
              placeholder="ALLE LÖSCHEN eingeben..."
              class="confirmation-input-field"
              [class.error]="showDeleteAllConfirmationError"
            >
            @if (showDeleteAllConfirmationError) {
              <span class="error-message">Bestätigungstext stimmt nicht überein</span>
            }
          </div>
        </div>
        
        <div class="delete-modal-footer">
          <button class="btn-secondary" (click)="cancelDeleteAll()">Abbrechen</button>
          <button class="btn-danger" (click)="confirmDeleteAll()" [disabled]="isDeletingAll || !isDeleteAllConfirmationValid()">
            @if (isDeletingAll) {
              <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
              Werden gelöscht...
            } @else {
              Alle Bestellungen löschen
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Order Details Modal -->
  @if (selectedOrder) {
    <div class="modal-overlay" (click)="closeOrderDetails()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Bestelldetails #{{ selectedOrder.order_id }}</h2>
          <button class="close-btn" (click)="closeOrderDetails()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <div class="modal-body">
          <!-- Customer Information -->
          <div class="detail-section">
            <h3>Kundeninformationen</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Name:</span>
                <span class="detail-value">{{ selectedOrder.name }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">E-Mail:</span>
                <span class="detail-value">{{ selectedOrder.email }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Rolle:</span>
                <span class="detail-value">
                  @if (selectedOrder.role) {
                    @if (isEmployee(selectedOrder)) {
                      <span class="role-badge employee">Sachbearbeiter</span>
                    } @else {
                      <span class="role-badge customer">Kunde</span>
                    }
                  } @else {
                    <span class="role-badge customer">Kunde</span>
                  }
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Kundennummer:</span>
                <span class="detail-value">{{ selectedOrder.customer_number || 'Keine Angabe' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Kunde:</span>
                <span class="detail-value" style="white-space: pre-line;">{{ getFullCustomerInfo(selectedOrder) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Lieferadresse:</span>
                <span class="detail-value">{{ selectedOrder.shipping_address || 'Keine Angabe' }}</span>
              </div>
            </div>
          </div>

          <!-- Order Information -->
          <div class="detail-section">
            <h3>Bestellinformationen</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Bestelldatum:</span>
                <span class="detail-value">{{ selectedOrder.order_date | date: 'dd.MM.yyyy' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Erstellt am:</span>
                <span class="detail-value">{{ selectedOrder.created_at | date: 'dd.MM.yyyy HH:mm' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Lieferart:</span>
                <span class="detail-value">{{ selectedOrder.fulfillment_type === 'delivery' ? 'Lieferung' : 'Abholung' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Liefer-/Abholdatum:</span>
                <span class="detail-value">{{ formatDate(selectedOrder.delivery_date) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Status:</span>
                <span class="detail-value">
                  <span class="status-badge" [class]="getStatusClass(selectedOrder.status)">
                    {{ getStatusText(selectedOrder.status) }}
                  </span>
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Zahlungsstatus:</span>
                <span class="detail-value">
                  <span class="payment-badge" [class]="'payment-' + selectedOrder.payment_status">
                    {{ getPaymentStatusText(selectedOrder.payment_status) }}
                  </span>
                </span>
              </div>
            </div>
          </div>

          <!-- Order Items -->
          <div class="detail-section">
            <h3>Bestellte Artikel ({{ selectedOrder.items.length }})</h3>
            <div class="items-table-container">
              <table class="items-table">
                <thead>
                  <tr>
                    <th>Menge</th>
                    <th>Artikelname</th>
                    <th>Artikelnr.</th>
                    <th>Preis Netto</th>
                    <th>Preis Brutto</th>
                    <th>Gesamt Netto</th>
                    <th>Gesamt Brutto</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of selectedOrder.items; track item.product_id) {
                    <tr>
                      <td class="quantity">{{ item.quantity }}</td>
                      <td class="product-name">{{ item.product_name }}</td>
                      <td class="article-number">{{ item.product_article_number }}</td>
                      <td class="price">
                        @if (item.different_price) {
                          <span class="original-price">{{ item.price | currency:'EUR':'symbol':'1.2-2' }}</span>
                          <span class="different-price">{{ item.different_price | currency:'EUR':'symbol':'1.2-2' }}</span>
                        } @else {
                          {{ item.price | currency:'EUR':'symbol':'1.2-2' }}
                        }
                      </td>
                      <td class="price-gross">
                        {{ getItemGrossPrice(item) | currency:'EUR':'symbol':'1.2-2' }}
                        <span class="tax-label">(inkl. {{ getTaxRatePercent(item.tax_code) }} MwSt.)</span>
                      </td>
                      <td class="total">
                         @if (item.different_price) {
                           {{ (getItemTotal(item.different_price, item.quantity)) | currency:'EUR':'symbol':'1.2-2' }}
                         } @else {
                           {{ (getItemTotal(item.price, item.quantity)) | currency:'EUR':'symbol':'1.2-2' }}
                         }
                       </td>
                       <td class="total-gross">
                         {{ (getItemGrossPrice(item) * item.quantity) | currency:'EUR':'symbol':'1.2-2' }}
                       </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
            <div class="order-totals-container">
              <div class="order-total">
                <span class="total-label">Gesamtpreis (Netto):</span>
                <span class="total-amount">{{ selectedOrder.total_price | currency:'EUR':'symbol':'1.2-2' }}</span>
              </div>
              <div class="order-total order-total-gross">
                <span class="total-label">Gesamtpreis (Brutto):</span>
                <span class="total-amount total-amount-gross">{{ getOrderTotalGross(selectedOrder) | currency:'EUR':'symbol':'1.2-2' }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn-secondary" (click)="closeOrderDetails()">Schließen</button>
          @if (selectedOrder.status === 'open') {
            <button class="btn-edit" (click)="editOrderAfterReload(selectedOrder)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
              Bestellung bearbeiten
            </button>
          } @else {
            <button class="btn-import" (click)="loadOrderToCustomerOrders(selectedOrder)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
              </svg>
              In Customer Orders importieren
            </button>
          }
          <button class="btn-primary" (click)="printAfterReload(selectedOrder)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
            </svg>
            Drucken
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Processing Warning Modal -->
  @if (showProcessingWarning) {
    <div class="modal-overlay" (click)="closeProcessingWarning()">
      <div class="warning-modal-content" (click)="$event.stopPropagation()">
        <div class="warning-modal-header">
          <h2>Bestellung wird bearbeitet</h2>
          <button class="close-btn" (click)="closeProcessingWarning()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        
        <div class="warning-modal-body">
          <div class="warning-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
            </svg>
          </div>
          
          <h3>Bestellung #{{ processingOrderId }} wird bereits bearbeitet</h3>
          <p class="warning-text">{{ processingWarningMessage }}</p>
          <p>Bitte warten Sie, bis die Bearbeitung abgeschlossen ist, oder kontaktieren Sie den anderen Benutzer.</p>
        </div>

        <div class="warning-modal-footer">
          <button class="btn-primary" (click)="closeProcessingWarning()">Verstanden</button>
        </div>
      </div>
    </div>
  }
</div> 