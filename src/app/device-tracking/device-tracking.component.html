<div class="tracking-container">
  <!-- Header Section -->
  <div class="tracking-header">
    <div class="header-content">
      <button class="back-btn" (click)="goBack()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        ZurÃ¼ck
      </button>
      <h1 class="tracking-title">
        <svg class="tracking-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        GerÃ¤te-Tracking
      </h1>
      <button class="refresh-btn" (click)="refresh()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Aktualisieren
      </button>
    </div>
  </div>

  <!-- Loading or Error State -->
  @if (error) {
    <div class="error-message">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <p>{{ error }}</p>
    </div>
  }

  @if (loading && positions.length === 0) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Lade Positionsdaten...</p>
    </div>
  }

  <!-- Split Layout -->
  <div class="split-container">
    <!-- Left: Device List -->
    @if (positions.length > 0) {
      <div class="devices-list-panel">
        <h2 class="section-title">VerfÃ¼gbare GerÃ¤te</h2>
        <div class="devices-list-content">
          @for (position of positions; track position.id) {
            @if (position.valid) {
              <div class="device-card">
                <div class="device-header">
                  <div class="device-color" [style.background-color]="getDeviceColor(position.deviceId)"></div>
                  <h3>GerÃ¤t {{ position.deviceId }}</h3>
                </div>
                <div class="device-info">
                  <p class="device-location">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    {{ position.address || `${position.latitude.toFixed(6)}, ${position.longitude.toFixed(6)}` }}
                  </p>
                  <div class="device-stats">
                    <div class="stat">
                      <span class="stat-label">Geschwindigkeit</span>
                      <span class="stat-value">{{ (position.speed * 3.6).toFixed(1) }} km/h</span>
                    </div>
                    @if (position.attributes && position.attributes.battery) {
                      <div class="stat">
                        <span class="stat-label">Batterie</span>
                        <span class="stat-value">{{ position.attributes.battery.toFixed(2) }}V</span>
                      </div>
                    }
                    <div class="stat">
                      <span class="stat-label">Satelliten</span>
                      <span class="stat-value">{{ position.attributes && position.attributes.sat ? position.attributes.sat : 'N/A' }}</span>
                    </div>
                  </div>
                  <div class="device-status">
                    @if (position.attributes && position.attributes.ignition !== undefined) {
                      <span class="status-badge" [class.ignition-on]="position.attributes.ignition">
                        {{ position.attributes.ignition ? 'ðŸŸ¢ An' : 'ðŸ”´ Aus' }}
                      </span>
                    }
                    @if (position.attributes && position.attributes.motion !== undefined) {
                      <span class="status-badge" [class.motion-on]="position.attributes.motion">
                        {{ position.attributes.motion ? 'ðŸŸ¢ Bewegt' : 'âšª Still' }}
                      </span>
                    }
                  </div>
                  <p class="device-time">
                    {{ formatDateTime(position.fixTime) }}
                  </p>
                </div>
              </div>
            }
          }
        </div>
      </div>
    }

    <!-- Right: Map Section -->
    <div class="map-panel">
      <div class="map-wrapper">
        <div id="tracking-map" class="tracking-map"></div>
      </div>
    </div>
  </div>

  <!-- Auto-refresh indicator -->
  <div class="refresh-indicator">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
    </svg>
    Automatische Aktualisierung alle 10 Sekunden
  </div>
</div>

